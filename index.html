<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web SMS Blast via Android Gateway</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f5f8fa; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: #fff; border-radius: 10px; padding: 28px 30px 18px 30px; box-shadow: 0 2px 10px #eee; }
    h1 { text-align: center; }
    label { font-weight: bold; display: block; margin: 16px 0 7px; }
    input[type="text"], input[type="url"], textarea { width: 100%; padding: 8px; border: 1px solid #bbb; border-radius: 4px; }
    textarea { resize: vertical; }
    .options { margin: 10px 0 18px 0; }
    button { background: #007bff; color: #fff; border: none; padding: 10px 18px; border-radius: 4px; font-size: 16px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .result { margin-top: 20px; background: #eef; padding: 10px 12px; border-radius: 6px; }
    .success { background: #d4edda; color: #256029; }
    .fail { background: #f8d7da; color: #721c24; }
    .api-settings { background: #f1f1f1; padding: 10px 12px; border-radius: 5px; }
    .note { font-size: 92%; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Text Blast via Android SMS Gateway</h1>
    <div class="api-settings">
      <label>Gateway API URL:</label>
      <input type="url" id="apiUrl" placeholder="e.g. http://192.168.1.10:8080/v1/sms/send" required>
      <label>API Key (if needed):</label>
      <input type="text" id="apiKey" placeholder="Leave blank if not required">
      <span class="note">Set these according to your Android SMS Gateway app settings.<br>
      Both your phone and this webpage must be on the same network for local IP to work.</span>
    </div>
    <form id="blastForm" autocomplete="off">
      <label>Recipient Numbers (one per line):</label>
      <textarea id="numbers" rows="3" placeholder="e.g. 09171234567&#10;09181234567"></textarea>
      <label>Message options:</label>
      <div class="options">
        <input type="radio" id="sameMsg" name="msgOption" checked>
        <label for="sameMsg" style="display:inline; font-weight:normal;">Same message for all</label>
        <input type="radio" id="customMsg" name="msgOption" style="margin-left:18px;">
        <label for="customMsg" style="display:inline; font-weight:normal;">Custom message per number</label>
      </div>
      <div id="sameMsgDiv">
        <label>Message Content:</label>
        <textarea id="message" rows="3" placeholder="Enter your message"></textarea>
      </div>
      <div id="customMsgDiv" style="display:none;">
        <label>Messages for Each Number:</label>
        <div id="recipients"></div>
      </div>
      <button type="submit">Send Blast</button>
    </form>
    <div id="result" class="result" style="display:none;"></div>
    <div style="margin-top:22px;" class="note">
      <b>Note:</b> This app sends HTTP requests to your Android SMS Gateway.<br>
      Your phone must be on and connected to WiFi for this to work.<br>
      Use responsibly to avoid carrier restrictions or spam.
    </div>
  </div>
  <script>
    // UI elements
    const apiUrl = document.getElementById('apiUrl');
    const apiKey = document.getElementById('apiKey');
    const numbersArea = document.getElementById('numbers');
    const sameMsgRadio = document.getElementById('sameMsg');
    const customMsgRadio = document.getElementById('customMsg');
    const sameMsgDiv = document.getElementById('sameMsgDiv');
    const customMsgDiv = document.getElementById('customMsgDiv');
    const recipientsDiv = document.getElementById('recipients');
    const blastForm = document.getElementById('blastForm');
    const resultDiv = document.getElementById('result');
    const messageArea = document.getElementById('message');

    // Helper to update per-recipient fields
    function updateRecipientFields() {
      let nums = numbersArea.value.split('\n').map(x => x.trim()).filter(x => x.length > 0);
      recipientsDiv.innerHTML = '';
      nums.forEach((num, i) => {
        let row = document.createElement('div');
        row.style.display = 'flex';
        row.style.gap = '6px';
        row.style.marginBottom = '6px';
        let numberInput = document.createElement('input');
        numberInput.type = 'text';
        numberInput.value = num;
        numberInput.readOnly = true;
        numberInput.style.flex = '2';
        let msgInput = document.createElement('input');
        msgInput.type = 'text';
        msgInput.placeholder = 'Custom message';
        msgInput.className = 'message';
        msgInput.style.flex = '3';
        msgInput.value = '';
        row.appendChild(numberInput);
        row.appendChild(msgInput);
        recipientsDiv.appendChild(row);
      });
    }

    numbersArea.addEventListener('input', () => {
      if (customMsgRadio.checked) updateRecipientFields();
    });
    sameMsgRadio.addEventListener('change', () => {
      if (sameMsgRadio.checked) {
        sameMsgDiv.style.display = '';
        customMsgDiv.style.display = 'none';
      }
    });
    customMsgRadio.addEventListener('change', () => {
      if (customMsgRadio.checked) {
        sameMsgDiv.style.display = 'none';
        customMsgDiv.style.display = '';
        updateRecipientFields();
      }
    });

    // Actual SMS sending via HTTP POST
    async function sendSMS(apiUrl, apiKey, number, message) {
      // Adjust payload as per your SMS Gateway app's API
      // Most apps accept: { phone_number: "...", message: "...", [api_key: "..."] }
      let payload = {
        phone_number: number,
        message: message
      };
      if (apiKey && apiKey.trim() !== "") payload.api_key = apiKey.trim();
      try {
        let resp = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        let data = await resp.json().catch(() => null);
        if (resp.ok && (!data || data.success !== false)) {
          return { success: true, detail: data ? (data.message || "Sent") : "Sent" };
        } else {
          return { success: false, detail: data ? (data.message || JSON.stringify(data)) : resp.statusText };
        }
      } catch (e) {
        return { success: false, detail: e.message };
      }
    }

    blastForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      // Validate
      let api = apiUrl.value.trim();
      if (!api) return alert("Please enter the Gateway API URL.");
      let nums = numbersArea.value.split('\n').map(x => x.trim()).filter(x => x.length > 0);
      if (nums.length === 0) return alert('Please enter recipient number/s.');
      let key = apiKey.value.trim();
      let sendList = [];
      if (sameMsgRadio.checked) {
        let msg = messageArea.value.trim();
        if (!msg) return alert('Please enter a message.');
        nums.forEach(num => sendList.push({ number: num, message: msg }));
      } else {
        let rows = recipientsDiv.querySelectorAll('div');
        for (let i = 0; i < rows.length; i++) {
          let num = rows[i].querySelector('input[type="text"]:not(.message)').value.trim();
          let msg = rows[i].querySelector('input.message').value.trim();
          if (!msg) return alert('Please enter a message for ' + num);
          sendList.push({ number: num, message: msg });
        }
      }
      resultDiv.style.display = '';
      resultDiv.innerHTML = 'Sending messages...';

      // Send all in sequence, update UI
      let results = [];
      for (let i = 0; i < sendList.length; i++) {
        let { number, message } = sendList[i];
        resultDiv.innerHTML = `Sending to <b>${number}</b>... (${i+1}/${sendList.length})`;
        let res = await sendSMS(api, key, number, message);
        results.push({ number, message, ...res });
      }
      // Show summary
      let html = `<b>Blast Result:</b><br><ul>`;
      results.forEach(r => {
        html += `<li><b>${r.number}:</b> <span class="${r.success ? 'success' : 'fail'}">${r.success ? '✔ Sent' : '✖ Fail'} - ${r.detail}</span></li>`;
      });
      html += "</ul>";
      resultDiv.innerHTML = html;
    });
  </script>
</body>
</html>
